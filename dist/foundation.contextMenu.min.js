"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):e.returnExports=t(e.jQuery)}(this,function(e){var t=function(){function t(n,i){_classCallCheck(this,t),this.$element=n,this.type=this.$element.attr("data-context-menu")||void 0,this.options=e.extend({},t.config,t.defaults,i,this._getConfig()),this._init(),-1===this.type.indexOf("#")&&this._registerKeys(),this._bindEvents(),Foundation.registerPlugin(this,"ContextMenu")}return _createClass(t,[{key:"_init",value:function(){this.keys={},this.$menu=0===this.type.indexOf("#")?e(this.type):this._getMenu(),this._render()}},{key:"_render",value:function(){this.$menu.hide().appendTo(e("body")),new Foundation.DropdownMenu(this.$menu)}},{key:"_getConfig",value:function(){return t.config[this.type]}},{key:"addConfig",value:function(e,n){t.config[e]=n}},{key:"_getMenu",value:function(t){var t=t||this.options.structure,n=e('<ul class="context menu dropdown vertical"></ul>');for(var i in t){var o=e("<li />"),s=e('<a href="#" />');if(t[i].cssClass&&o.addClass(t[i].cssClass),t[i].icon&&s.append('<span class="icon '+t[i].icon+'"></span>'),t[i].text&&s.append(t[i].text),t[i].help&&s.append("<small>"+t[i].help+"</small>"),t[i].click&&"function"==typeof t[i].click){var u=this;!function(e){o.on("click.zf.context",function(){t[e].click(u.$element)})}(i)}if(t[i].href&&s.attr("href",t[i].href),o.append(s),t[i].children){var c=this._getMenu(t[i].children);c.addClass("menu").appendTo(o)}this.options.accessible&&(t[i].children||t[i].href||t[i].click)&&o.attr({tabindex:0}),n.append(o)}return n}},{key:"_bindEvents",value:function(){var t,n=this;this.$element.on("contextmenu.zf.context touchstart.zf.context",function(e){e.preventDefault(),e.stopPropagation(),"touchstart"===e.type?t=setTimeout(function(){n.show(e)},n.options.touchdelay):n.show(e)}).on("touchend.zf.context",function(e){t&&clearTimeout(t)}),e("body").on("click.zf.context touchstart.zf.context",function(t){!n.open||e(t.target).is(n.$menu.add(e(n.$menu.find("*"))))||e(t.target).is(n.$element)&&3===t.button&&"touchstart"!==t.type||n.hide()}).on("keydown.zf.context",function(e){if(n.open){var t=n.keys[Foundation.Keyboard.parseKey(e)];t&&"function"==typeof t&&t(n.$element)}}),this.$element.find("[data-context-menu-trigger]").click(function(e){e.stopPropagation(),n.show(),n.$menu.attr({tabindex:"-1"}).focus()})}},{key:"_registerKeys",value:function(e){for(var e=e||this.options.structure,t=0;t<e.length;t++)e[t].key&&(this.keys[e[t].key]=e[t].click)}},{key:"show",value:function(t){var n,i;if(t&&"contextmenu"===t.type){var t=t||window.event;n=t.pageX||t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.pageY||t.clientY+document.body.scrollTop+document.documentElement.scrollTop}else n=this.$element.offset().left+this.$element.outerWidth(),i=this.$element.offset().top;this.$menu.css("visibility","hidden").show(),n+this.$menu.outerWidth()>e(window).outerWidth()&&(n=e(window).outerWidth()-this.$menu.outerWidth()-this.options.screenOffset,this.$menu.addClass("align-right")),this.$menu.css({top:i,left:n}),this.options.single&&e("body").trigger("click"),this.$menu.css("visibility",""),this.open=!0,this.$element.trigger("show.zf.contextMenu")}},{key:"hide",value:function(e){this.$menu.hide().removeClass("align-right"),this.open=!1,this.$element.trigger("hide.zf.contextMenu")}},{key:"destroy",value:function(){this.$menu.hide().remove(),this.$element.trigger("destroyed.zf.contextMenu"),Foundation.unregisterPlugin(this)}}]),t}();return t.defaults={single:!0,accessible:!0,touchdelay:400,screenOffset:10},t.config={},Foundation.plugin(t,"ContextMenu"),t});