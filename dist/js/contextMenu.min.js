!function(t,e){"use strict";function n(i){this.$element=i,e.FeatherNest(this.$element,"context"),this.type=this.$element.attr("data-context-menu")||void 0,this.options=t.extend({},n.prototype.config,this._getConfig()),this._init(),-1===this.type.indexOf("#")&&this._registerKeys(),this._bindEvents(),e.registerPlugin(this)}n.prototype.config={single:!0,accessible:!0,touchdelay:400,screenOffset:10},n.prototype._init=function(){this.keys={},this.$menu=0===this.type.indexOf("#")?t(this.type):this._getMenu(),this._render()},n.prototype._render=function(){this.$menu.hide().appendTo(t("body")),new e.DropdownMenu(this.$menu)},n.prototype._getConfig=function(){return this.config[this.type]},n.prototype.addConfig=function(t,e){n.prototype.config[t]=e},n.prototype._getMenu=function(e){var e=e||this.options.structure,n=t('<ul class="context menu dropdown vertical"></ul>');for(var i in e){var o=t("<li />"),s=t('<a href="#" />');if(e[i]["class"]&&o.addClass(e[i]["class"]),e[i].icon&&s.append('<span class="icon '+e[i].icon+'"></span>'),e[i].text&&s.text(e[i].text),e[i].help&&s.append("<small>"+e[i].help+"</small>"),e[i].click&&"function"==typeof e[i].click){var c=this;!function(t){o.on("click.zf.context",function(){e[t].click(c.$element)})}(i)}if(e[i].href&&s.attr("href",e[i].href),o.append(s),e[i].children){o.addClass("has-submenu");var r=this._getMenu(e[i].children);r.addClass("submenu").appendTo(o)}this.options.accessible&&(e[i].children||e[i].href||e[i].click)&&o.attr({tabindex:0}),n.append(o)}return n},n.prototype._bindEvents=function(){var n,i=this;this.$element.on("contextmenu.zf.context touchstart.zf.context",function(t){t.preventDefault(),t.stopPropagation(),"touchstart"===t.type?n=setTimeout(function(){i.show(t)},i.options.touchdelay):i.show(t)}).on("touchend.zf.context",function(t){n&&clearTimeout(n)}),t("body").on("click.zf.context touchstart.zf.context",function(e){!i.open||t(e.target).is(i.$menu.add(t(i.$menu.find("*"))))||t(e.target).is(i.$element)&&3===e.button&&"touchstart"!==e.type||i.hide()}).on("keydown.zf.context",function(t){if(i.open){var n=i.keys[e.Keyboard.parseKey(t)];n&&"function"==typeof n&&n(i.$element)}}),this.$element.find("[data-context-menu-trigger]").click(function(t){t.stopPropagation(),i.show(),i.$menu.attr({tabindex:"-1"}).focus()})},n.prototype._registerKeys=function(t){for(var t=t||this.options.structure,e=0;e<t.length;e++)t[e].key&&(this.keys[t[e].key]=t[e].click)},n.prototype.show=function(e){var n,i;if(e&&"contextmenu"===e.type){var e=e||window.event;n=e.pageX||e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=e.pageY||e.clientY+document.body.scrollTop+document.documentElement.scrollTop}else n=this.$element.offset().left+this.$element.outerWidth(),i=this.$element.offset().top;this.$menu.css("visibility","hidden").show(),n+this.$menu.outerWidth()>t(window).outerWidth()&&(n=t(window).outerWidth()-this.$menu.outerWidth()-this.options.screenOffset,this.$menu.addClass("align-right")),this.$menu.css({top:i,left:n}),this.options.single&&t("body").trigger("click"),this.$menu.css("visibility",""),this.open=!0},n.prototype.hide=function(t){this.$menu.hide().removeClass("align-right"),this.open=!1},e.plugin(n)}(jQuery,window.Foundation);