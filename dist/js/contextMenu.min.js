!function(t,e){"use strict";function n(o){this.$element=o,e.FeatherNest(this.$element,"context"),this.type=this.$element.attr("data-context-menu")||void 0,this.options=t.extend({},n.prototype.config,this._getConfig()),this._init(),this._bindEvents(),e.registerPlugin(this)}n.prototype.config={single:!0,accessible:!0,touchdelay:500},n.prototype._init=function(){console.log("_init",this),this.$menu=0===this.type.indexOf("#")?t(this.type):this._getMenu(),this._render()},n.prototype._render=function(){this.$menu.hide().appendTo(t("body")),new e.DropdownMenu(this.$menu)},n.prototype._getConfig=function(){return this.config[this.type]},n.prototype.addConfig=function(t,e){n.prototype.config[t]=e},n.prototype._getMenu=function(e){var e=e||this.options.structure,n=t('<ul class="context menu dropdown vertical"></ul>');for(var o in e){var i=t("<li></li>");if(e[o]["class"]&&i.addClass(e[o]["class"]),e[o].icon&&(i.append('<span class="icon '+e[o].icon+'"></span>'),e[o].help&&i.append("<small>"+e[o].help+"</small>")),e[o].text&&(i.append('<span class="text">'+e[o].text+"</span>"),e[o].help&&i.append("<small>"+e[o].help+"</small>")),e[o].href&&i.click(function(){location.href=e[o].href}),e[o].click&&i.click(e[o].click),e[o].href&&i.attr({"data-href":e[o].href}),e[o].children){i.addClass("has-submenu");var s=this._getMenu(e[o].children);s.addClass("submenu").appendTo(i)}this.options.accessible&&(e[o].children||e[o].href||e[o].click)&&i.attr({tabindex:0}),n.append(i)}return n},n.prototype._bindEvents=function(){var e,n=this;this.$element.on("contextmenu touchstart",function(t){t.preventDefault(),t.stopPropagation(),console.log(t),"touchstart"===t.type?e=setTimeout(function(){n.show(t)},n.options.touchdelay):n.show(t)}).on("touchend",function(t){e&&clearTimeout(e)}),t("body").on("click",function(e){console.log("Close",e),!n.open||t(e.target).is(n.$menu.add(t(n.$menu.children())))||t(e.target).is(n.$element)&&3===e.button&&"touchstart"!==e.type||n.hide()}),this.$element.find("[data-context-menu-trigger]").click(function(t){t.stopPropagation(),n.show(),n.$menu.attr({tabindex:"-1"}).focus()})},n.prototype.show=function(e){var n,o;if(e&&"contextmenu"===e.type){var e=e||window.event;n=e.pageX||e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o=e.pageY||e.clientY+document.body.scrollTop+document.documentElement.scrollTop}else n=this.$element.offset().left+this.$element.outerWidth(),o=this.$element.offset().top;this.$menu.css({top:o,left:n}),this.options.single&&t("body").trigger("click"),this.$menu.show(),this.open=!0},n.prototype.hide=function(t){this.$menu.hide(),this.open=!1},e.plugin(n)}(jQuery,window.Foundation);